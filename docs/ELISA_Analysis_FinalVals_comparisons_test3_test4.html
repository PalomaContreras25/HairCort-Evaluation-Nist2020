<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />



<meta name="date" content="2025-04-08" />

<title>Comparing calculation methods, test3 and test4</title>

<script src="site_libs/header-attrs-2.29/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.13.2/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/textmate.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<link rel="icon" href="https://github.com/workflowr/workflowr-assets/raw/main/img/reproducible.png">
<!-- Add a small amount of space between sections. -->
<style type="text/css">
div.section {
  padding-top: 12px;
}
</style>



<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>









<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">HairCort-Evaluation-Nist2020</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="about.html">About</a>
</li>
<li>
  <a href="license.html">License</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Comparing calculation methods, test3 and
test4</h1>
<h4 class="date">2025-04-08</h4>

</div>


<p>
<button type="button" class="btn btn-default btn-workflowr btn-workflowr-report" data-toggle="collapse" data-target="#workflowr-report">
<span class="glyphicon glyphicon-list" aria-hidden="true"></span>
workflowr <span class="glyphicon glyphicon-exclamation-sign text-danger"
aria-hidden="true"></span>
</button>
</p>
<div id="workflowr-report" class="collapse">
<ul class="nav nav-tabs">
<li class="active">
<a data-toggle="tab" href="#summary">Summary</a>
</li>
<li>
<a data-toggle="tab" href="#checks"> Checks <span
class="glyphicon glyphicon-exclamation-sign text-danger"
aria-hidden="true"></span> </a>
</li>
<li>
<a data-toggle="tab" href="#versions">Past versions</a>
</li>
</ul>
<div class="tab-content">
<div id="summary" class="tab-pane fade in active">
<p>
<strong>Last updated:</strong> 2025-04-11
</p>
<p>
<strong>Checks:</strong> <span
class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> 6
<span class="glyphicon glyphicon-exclamation-sign text-danger"
aria-hidden="true"></span> 1
</p>
<p>
<strong>Knit directory:</strong>
<code>HairCort-Evaluation-Nist2020/</code> <span
class="glyphicon glyphicon-question-sign" aria-hidden="true"
title="This is the local directory in which the code in this file was executed.">
</span>
</p>
<p>
This reproducible <a href="https://rmarkdown.rstudio.com">R Markdown</a>
analysis was created with <a
  href="https://github.com/workflowr/workflowr">workflowr</a> (version
1.7.1). The <em>Checks</em> tab describes the reproducibility checks
that were applied when the results were created. The <em>Past
versions</em> tab lists the development history.
</p>
<hr>
</div>
<div id="checks" class="tab-pane fade">
<div id="workflowr-checks" class="panel-group">
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongRMarkdownfilestronguncommittedchanges">
<span class="glyphicon glyphicon-exclamation-sign text-danger"
aria-hidden="true"></span> <strong>R Markdown file:</strong> uncommitted
changes </a>
</p>
</div>
<div id="strongRMarkdownfilestronguncommittedchanges"
class="panel-collapse collapse">
<div class="panel-body">
<p>The R Markdown file has unstaged changes. To know which version of
the R Markdown file created these results, you‚Äôll want to first commit
it to the Git repo. If you‚Äôre still working on the analysis, you can
ignore this warning. When you‚Äôre finished, you can run
<code>wflow_publish</code> to commit the R Markdown file and build the
HTML.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongEnvironmentstrongempty">
<span class="glyphicon glyphicon-ok text-success"
aria-hidden="true"></span> <strong>Environment:</strong> empty </a>
</p>
</div>
<div id="strongEnvironmentstrongempty" class="panel-collapse collapse">
<div class="panel-body">
<p>Great job! The global environment was empty. Objects defined in the
global environment can affect the analysis in your R Markdown file in
unknown ways. For reproduciblity it‚Äôs best to always run the code in an
empty environment.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongSeedstrongcodesetseed20241016code">
<span class="glyphicon glyphicon-ok text-success"
aria-hidden="true"></span> <strong>Seed:</strong>
<code>set.seed(20241016)</code> </a>
</p>
</div>
<div id="strongSeedstrongcodesetseed20241016code"
class="panel-collapse collapse">
<div class="panel-body">
<p>The command <code>set.seed(20241016)</code> was run prior to running
the code in the R Markdown file. Setting a seed ensures that any results
that rely on randomness, e.g. subsampling or permutations, are
reproducible.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongSessioninformationstrongrecorded">
<span class="glyphicon glyphicon-ok text-success"
aria-hidden="true"></span> <strong>Session information:</strong>
recorded </a>
</p>
</div>
<div id="strongSessioninformationstrongrecorded"
class="panel-collapse collapse">
<div class="panel-body">
<p>Great job! Recording the operating system, R version, and package
versions is critical for reproducibility.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongCachestrongnone">
<span class="glyphicon glyphicon-ok text-success"
aria-hidden="true"></span> <strong>Cache:</strong> none </a>
</p>
</div>
<div id="strongCachestrongnone" class="panel-collapse collapse">
<div class="panel-body">
<p>Nice! There were no cached chunks for this analysis, so you can be
confident that you successfully produced the results during this
run.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongFilepathsstrongrelative">
<span class="glyphicon glyphicon-ok text-success"
aria-hidden="true"></span> <strong>File paths:</strong> relative </a>
</p>
</div>
<div id="strongFilepathsstrongrelative" class="panel-collapse collapse">
<div class="panel-body">
<p>Great job! Using relative paths to the files within your workflowr
project makes it easier to run your code on other machines.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongRepositoryversionstrongahrefhttpsgithubcomPalomaContreras25HairCortEvaluationNist2020tree16ce91c12594e99d1691896d5d0df7dc690fe51dtargetblank16ce91ca">
<span class="glyphicon glyphicon-ok text-success"
aria-hidden="true"></span> <strong>Repository version:</strong>
<a href="https://github.com/PalomaContreras25/HairCort-Evaluation-Nist2020/tree/16ce91c12594e99d1691896d5d0df7dc690fe51d" target="_blank">16ce91c</a>
</a>
</p>
</div>
<div
id="strongRepositoryversionstrongahrefhttpsgithubcomPalomaContreras25HairCortEvaluationNist2020tree16ce91c12594e99d1691896d5d0df7dc690fe51dtargetblank16ce91ca"
class="panel-collapse collapse">
<div class="panel-body">
<p>
Great! You are using Git for version control. Tracking code development
and connecting the code version to the results is critical for
reproducibility.
</p>
<p>
The results in this page were generated with repository version
<a href="https://github.com/PalomaContreras25/HairCort-Evaluation-Nist2020/tree/16ce91c12594e99d1691896d5d0df7dc690fe51d" target="_blank">16ce91c</a>.
See the <em>Past versions</em> tab to see a history of the changes made
to the R Markdown and HTML files.
</p>
<p>
Note that you need to be careful to ensure that all relevant files for
the analysis have been committed to Git prior to generating the results
(you can use <code>wflow_publish</code> or
<code>wflow_git_commit</code>). workflowr only checks the R Markdown
file, but you know if there are other scripts or data files that it
depends on. Below is the status of the Git repository when the results
were generated:
</p>
<pre><code>
Ignored files:
    Ignored:    .DS_Store
    Ignored:    .RData
    Ignored:    .Rhistory
    Ignored:    analysis/.DS_Store
    Ignored:    analysis/.Rhistory
    Ignored:    data/.DS_Store
    Ignored:    data/Test3/.DS_Store
    Ignored:    data/Test4/.DS_Store

Unstaged changes:
    Modified:   analysis/ELISA_Analysis_FinalVals_comparisons_test3_test4.Rmd
    Modified:   data/Test4/Data_Cortisol_Processed.csv

</code></pre>
<p>
Note that any generated files, e.g.¬†HTML, png, CSS, etc., are not
included in this status report because it is ok for generated content to
have uncommitted changes.
</p>
</div>
</div>
</div>
</div>
<hr>
</div>
<div id="versions" class="tab-pane fade">
<p>
These are the previous versions of the repository in which changes were
made to the R Markdown
(<code>analysis/ELISA_Analysis_FinalVals_comparisons_test3_test4.Rmd</code>)
and HTML
(<code>docs/ELISA_Analysis_FinalVals_comparisons_test3_test4.html</code>)
files. If you‚Äôve configured a remote Git repository (see
<code>?wflow_git_remote</code>), click on the hyperlinks in the table
below to view the files as they were in that past version.
</p>
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
File
</th>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
<th>
Message
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/PalomaContreras25/HairCort-Evaluation-Nist2020/blob/16ce91c12594e99d1691896d5d0df7dc690fe51d/analysis/ELISA_Analysis_FinalVals_comparisons_test3_test4.Rmd" target="_blank">16ce91c</a>
</td>
<td>
Paloma
</td>
<td>
2025-04-10
</td>
<td>
recalc_evaluations
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/PalomaContreras25/HairCort-Evaluation-Nist2020/16ce91c12594e99d1691896d5d0df7dc690fe51d/docs/ELISA_Analysis_FinalVals_comparisons_test3_test4.html" target="_blank">16ce91c</a>
</td>
<td>
Paloma
</td>
<td>
2025-04-10
</td>
<td>
recalc_evaluations
</td>
</tr>
</tbody>
</table>
</div>
<hr>
</div>
</div>
</div>
<div id="test4" class="section level1">
<h1>Test4</h1>
<p>Category Description TA Non-spiked serial dilution TB Spiked only in
first dilution (TB1) then serially diluted TC Each dilution individually
spiked with 25 ¬µL of std1 TD First tube spiked 1:1 with std1 (110 ¬µL),
then serially diluted TP Precision replicates (different weights: 6, 9,
12 mg) spiked with 25 ¬µL</p>
<pre class="r"><code># Conversion and Constants
data$Buffer_ml &lt;- data$Buffer_nl / 1000
data$Vol_in_well.tube_ml &lt;- data$Vol_in_well.tube_uL / 1000
data$SpikeVol_ml &lt;- data$SpikeVol_uL / 1000

# Spike concentration (pg/mL)
std_conc &lt;- (3191+3228)/2

# Method A: No spike correction
data$Final_pg.mg_A &lt;- ((data$Ave_Conc_pg.ml / data$Weight_mg) *
                         data$Extraction_ratio * data$Buffer_ml * data$Dilution_sample)

# Method B: Subtract spike reading (std) and apply dilution factor (√ó2)
data$Final_pg.mg_B &lt;- ifelse(
  data$Spike == 1,
  ((data$Ave_Conc_pg.ml - std_conc) / data$Weight_mg) *
    data$Extraction_ratio * data$Buffer_ml * 2,
  # fallback to method A if not spiked
 data$Final_pg.mg_A
)

# Method D: Spike contribution subtracted
data$Spike_Contribution &lt;- (data$SpikeVol_ml * std_conc) / data$Vol_in_well.tube_ml /  data$Dilution_spike

data$Final_pg.mg_D &lt;- ((data$Ave_Conc_pg.ml - data$Spike_Contribution) / data$Weight_mg) *
     data$Extraction_ratio * data$Buffer_ml * data$Dilution_sample
data4&lt;-data</code></pre>
<pre class="r"><code># Save result
head(data)</code></pre>
<pre><code>  Wells Sample Category Weight_mg Buffer_nl Spike SpikeVol_uL Dilution_sample
1    A3     B0       b0        NA        NA     0           0               1
2    B3     B0       b0        NA        NA     0           0               1
3   G12     BE       be        NA        NA     0           0               1
4   H12     BE       be        NA        NA     0           0               1
5    A1    NSB      nsb        NA        NA     0           0               1
6    B1    NSB      nsb        NA        NA     0           0               1
  Dilution_spike Vol_in_well.tube_uL Extraction_ratio Raw.OD Binding.Perc
1              1                  NA               NA  0.874        100.0
2              1                  NA               NA  1.010           NA
3              1                  NA               NA  0.553         70.8
4              1                  NA               NA  0.812           NA
5              1                  NA               NA  0.052          0.0
6              1                  NA               NA  0.052           NA
  Conc_pg.ml Ave_Conc_pg.ml CV.Perc  SD   SEM CV_categ Binding.Perc_categ
1     140.60          86.84    87.5  76  53.7  HIGH CV  ABOVE 80% binding
2      33.09             NA      NA  NA    NA     &lt;NA&gt;               &lt;NA&gt;
3     717.50         462.90    77.8 360 255.0  HIGH CV               &lt;NA&gt;
4     208.40             NA      NA  NA    NA     &lt;NA&gt;               &lt;NA&gt;
5   15610.00       15610.00     0.0   0   0.0     &lt;NA&gt;  UNDER 20% binding
6   15610.00             NA      NA  NA    NA     &lt;NA&gt;               &lt;NA&gt;
             Failed_samples Buffer_ml Vol_in_well.tube_ml SpikeVol_ml
1 HIGH CV;ABOVE 80% binding        NA                  NA           0
2                        OK        NA                  NA           0
3                   HIGH CV        NA                  NA           0
4                        OK        NA                  NA           0
5         UNDER 20% binding        NA                  NA           0
6                        OK        NA                  NA           0
  Final_pg.mg_A Final_pg.mg_B Spike_Contribution Final_pg.mg_D
1            NA            NA                 NA            NA
2            NA            NA                 NA            NA
3            NA            NA                 NA            NA
4            NA            NA                 NA            NA
5            NA            NA                 NA            NA
6            NA            NA                 NA            NA</code></pre>
<pre class="r"><code>write.csv(data, file.path(data_path, &quot;Data_Cortisol_Processed.csv&quot;), row.names = FALSE)

# View summary
summary(data$Final_pg.mg_A)</code></pre>
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA&#39;s 
  17.13   29.01   32.27   35.28   39.47   82.94      45 </code></pre>
<pre class="r"><code>summary(data$Final_pg.mg_B)</code></pre>
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA&#39;s 
-45.870 -35.833  -5.960  -3.488  23.109  50.963      45 </code></pre>
<pre class="r"><code>summary(data$Final_pg.mg_D)</code></pre>
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA&#39;s 
  7.472  18.533  24.559  27.009  31.196  80.804      45 </code></pre>
<pre class="r"><code># Reshape data for plotting
data_long &lt;- data %&gt;%
  pivot_longer(
    cols = c(Final_pg.mg_A, Final_pg.mg_B, Final_pg.mg_D),
    names_to = &quot;Method&quot;,
    values_to = &quot;Final_pg.mg&quot;
  )

ggplot(data_long, aes(x = Sample, y = Final_pg.mg, color = Method, group = Method)) +
  geom_line(aes(group = Sample), color = &quot;gray75&quot;, size = 0.5) +
  geom_point(size = 2.8, alpha = 0.7, position = position_dodge(width=0.5)) +
  scale_color_manual(
    values = c(&quot;Final_pg.mg_A&quot; = &quot;steelblue&quot;,
               &quot;Final_pg.mg_B&quot; = &quot;orange&quot;,
               &quot;Final_pg.mg_D&quot; = &quot;darkgreen&quot;),
    labels = c(&quot;Method A (Basic)&quot;,
               &quot;Method B (Subtraction + x2)&quot;,
               &quot;Method D (Spike contribution)&quot;)
  ) +
  labs(
    title = &quot;Hair Cortisol by Sample and Calculation Method&quot;,
    x = &quot;Sample ID&quot;,
    y = &quot;Final Cortisol (pg/mg)&quot;,
    color = &quot;Method&quot;
  ) +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 90, hjust = 1),
    legend.position = &quot;top&quot;
  )</code></pre>
<p><img src="figure/ELISA_Analysis_FinalVals_comparisons_test3_test4.Rmd/unnamed-chunk-4-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-unnamed-chunk-4-1">
Past versions of unnamed-chunk-4-1.png
</button>
</p>
<div id="fig-unnamed-chunk-4-1" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/PalomaContreras25/HairCort-Evaluation-Nist2020/blob/16ce91c12594e99d1691896d5d0df7dc690fe51d/docs/figure/ELISA_Analysis_FinalVals_comparisons_test3_test4.Rmd/unnamed-chunk-4-1.png" target="_blank">16ce91c</a>
</td>
<td>
Paloma
</td>
<td>
2025-04-10
</td>
</tr>
</tbody>
</table>
</div>
</div>
<pre class="r"><code># Arrange by Sample for consistent ordering
data &lt;- data %&gt;% arrange(Sample)

# Reshape to long format
data_long &lt;- data %&gt;%
  pivot_longer(
    cols = c(Final_pg.mg_A, Final_pg.mg_D),
    names_to = &quot;Method&quot;,
    values_to = &quot;Final_pg.mg&quot;
  )

# Plot with lines connecting A and D values for each sample
ggplot(data_long, aes(x = Sample, y = Final_pg.mg, color = Method, group = Method)) +
  geom_line(aes(group = Sample), linewidth = 0.6, color = &quot;gray70&quot;) +  # light line connecting methods
  geom_point(size = 2.8, alpha = 0.8, position = position_dodge(width = 0.5)) +
  scale_color_manual(
    values = c(&quot;Final_pg.mg_A&quot; = &quot;steelblue&quot;, &quot;Final_pg.mg_D&quot; = &quot;darkgreen&quot;),
    labels = c(&quot;Method A&quot;, &quot;Method D&quot;)
  ) +
  labs(
    title = &quot;Hair Cortisol Concentration by Sample&quot;,
    x = &quot;Sample ID&quot;,
    y = &quot;Final Cortisol (pg/mg)&quot;,
    color = &quot;Calculation Method&quot;
  ) +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1),
    legend.position = &quot;top&quot;
  )</code></pre>
<p><img src="figure/ELISA_Analysis_FinalVals_comparisons_test3_test4.Rmd/unnamed-chunk-5-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-unnamed-chunk-5-1">
Past versions of unnamed-chunk-5-1.png
</button>
</p>
<div id="fig-unnamed-chunk-5-1" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/PalomaContreras25/HairCort-Evaluation-Nist2020/blob/16ce91c12594e99d1691896d5d0df7dc690fe51d/docs/figure/ELISA_Analysis_FinalVals_comparisons_test3_test4.Rmd/unnamed-chunk-5-1.png" target="_blank">16ce91c</a>
</td>
<td>
Paloma
</td>
<td>
2025-04-10
</td>
</tr>
</tbody>
</table>
</div>
</div>
<pre class="r"><code># Filter to include only good quality samples
data_ok &lt;- data %&gt;%
    filter(!is.na(Binding.Perc)) %&gt;%
  filter(Failed_samples == &quot;OK&quot;)

# Reshape data for plotting
data_long_ok &lt;- data_ok %&gt;%
  pivot_longer(
    cols = c(Final_pg.mg_A, Final_pg.mg_D),
    names_to = &quot;Method&quot;,
    values_to = &quot;Final_pg.mg&quot;
  )

head(data_long_ok)</code></pre>
<pre><code># A tibble: 6 √ó 28
  Wells Sample Category Weight_mg Buffer_nl Spike SpikeVol_uL Dilution_sample
  &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;        &lt;int&gt;     &lt;int&gt; &lt;int&gt;       &lt;int&gt;           &lt;int&gt;
1 E12   POOL   pool            20       250     0           0               1
2 E12   POOL   pool            20       250     0           0               1
3 G3    TA3    A               50       250     0           0               4
4 G3    TA3    A               50       250     0           0               4
5 A4    TA4    A               50       250     0           0               8
6 A4    TA4    A               50       250     0           0               8
# ‚Ñπ 20 more variables: Dilution_spike &lt;int&gt;, Vol_in_well.tube_uL &lt;int&gt;,
#   Extraction_ratio &lt;dbl&gt;, Raw.OD &lt;dbl&gt;, Binding.Perc &lt;dbl&gt;, Conc_pg.ml &lt;dbl&gt;,
#   Ave_Conc_pg.ml &lt;dbl&gt;, CV.Perc &lt;dbl&gt;, SD &lt;dbl&gt;, SEM &lt;dbl&gt;, CV_categ &lt;chr&gt;,
#   Binding.Perc_categ &lt;chr&gt;, Failed_samples &lt;chr&gt;, Buffer_ml &lt;dbl&gt;,
#   Vol_in_well.tube_ml &lt;dbl&gt;, SpikeVol_ml &lt;dbl&gt;, Final_pg.mg_B &lt;dbl&gt;,
#   Spike_Contribution &lt;dbl&gt;, Method &lt;chr&gt;, Final_pg.mg &lt;dbl&gt;</code></pre>
<pre class="r"><code># Plot for OK samples only
ggplot(data_long_ok, aes(x = Sample, y = Final_pg.mg, color = Method)) +
  geom_line(aes(group = Sample), color = &quot;gray75&quot;, size = 0.5) +
  geom_point(size = 3, alpha = 0.8, position = position_dodge(width = 0.5)) +
  scale_color_manual(
    values = c(&quot;Final_pg.mg_A&quot; = &quot;steelblue&quot;,
               &quot;Final_pg.mg_B&quot; = &quot;orange&quot;,
               &quot;Final_pg.mg_D&quot; = &quot;darkgreen&quot;),
    labels = c(&quot;Method A (Basic)&quot;,
               &quot;Method B (Subtraction + x2)&quot;,
               &quot;Method D (Spike contribution)&quot;)
  ) +
  labs(
    title = &quot;Hair Cortisol (Good Samples Only) ‚Äî Test4&quot;,
    x = &quot;Sample ID&quot;,
    y = &quot;Final Cortisol (pg/mg)&quot;,
    color = &quot;Method&quot;
  ) +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 90, hjust = 1),
    legend.position = &quot;top&quot;
  )</code></pre>
<p><img src="figure/ELISA_Analysis_FinalVals_comparisons_test3_test4.Rmd/unnamed-chunk-6-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-unnamed-chunk-6-1">
Past versions of unnamed-chunk-6-1.png
</button>
</p>
<div id="fig-unnamed-chunk-6-1" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/PalomaContreras25/HairCort-Evaluation-Nist2020/blob/16ce91c12594e99d1691896d5d0df7dc690fe51d/docs/figure/ELISA_Analysis_FinalVals_comparisons_test3_test4.Rmd/unnamed-chunk-6-1.png" target="_blank">16ce91c</a>
</td>
<td>
Paloma
</td>
<td>
2025-04-10
</td>
</tr>
</tbody>
</table>
</div>
</div>
<pre class="r"><code>summary(data_ok$Final_pg.mg_D)</code></pre>
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA&#39;s 
  11.80   18.45   24.09   24.05   30.32   40.40       1 </code></pre>
</div>
<div id="test3" class="section level1">
<h1>Test3</h1>
<pre class="r"><code>#path:
data_path  = &quot;./data/Test3&quot;

# Load the dataset
data3 &lt;- read.csv(file.path(data_path,&quot;Data_QC_flagged.csv&quot;))
data &lt;- data3
data$Failed_samples[is.na(data$Failed_samples)] &lt;- &quot;OK&quot;
# Conversion and Constants
data$Buffer_ml &lt;- data$Buffer_nl / 1000
data$TotalVol_well_mL &lt;- data$TotalVol_well_uL / 1000
data$SpikeVol_ml &lt;- data$SpikeVol_uL / 1000

# Extraction ratio
extraction &lt;- 1 / 0.75

# Spike concentration (pg/mL)
std_conc &lt;- 3139.5

# Method A: No spike correction
data$Final_pg.mg_A &lt;- ((data$Ave_Conc_pg.ml / data$Weight_mg) *
                         extraction * data$Buffer_ml * data$Dilution)

# Method B: Subtract spike reading (std) and apply dilution factor (√ó2)
data$Final_pg.mg_B &lt;- ifelse(
  data$Spike == 1,
  ((data$Ave_Conc_pg.ml - std_conc) / data$Weight_mg) *
    extraction * data$Buffer_ml * 2,
  # fallback to method A if not spiked
 data$Final_pg.mg_A
)

# Method D: Spike contribution subtracted
data$Spike_Contribution &lt;- ifelse(
  data$Spike == 1,
  ((data$SpikeVol_ml * std_conc) / data$TotalVol_well_mL) / data$Dilution,
  0
)

data$Final_pg.mg_D &lt;- (
  (data$Ave_Conc_pg.ml - data$Spike_Contribution) / data$Weight_mg) *
    extraction * data$Buffer_ml * data$Dilution


# Save result
write.csv(data, file.path(data_path,&quot;Data_Cortisol_Processed.csv&quot;), row.names = FALSE)

# View summary
summary(data$Final_pg.mg_A)</code></pre>
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 0.8836  5.5134 10.5540 14.4346 12.9448 60.4831 </code></pre>
<pre class="r"><code>summary(data$Final_pg.mg_B)</code></pre>
<pre><code>    Min.  1st Qu.   Median     Mean  3rd Qu.     Max. 
-30.7005  -3.0170   4.3358   0.8079   9.6526  12.0647 </code></pre>
<pre class="r"><code>summary(data$Final_pg.mg_D)</code></pre>
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 0.8836  5.0099  7.8851  8.6067 10.9813 22.5664 </code></pre>
<pre class="r"><code># Reshape data for plotting
data_long &lt;- data %&gt;%
  pivot_longer(
    cols = c(Final_pg.mg_A, Final_pg.mg_B, Final_pg.mg_D),
    names_to = &quot;Method&quot;,
    values_to = &quot;Final_pg.mg&quot;
  )

ggplot(data_long, aes(x = Sample, y = Final_pg.mg, color = Method, group = Method)) +
  geom_line(aes(group = Sample), color = &quot;gray75&quot;, size = 0.5) +
  geom_point(size = 3, alpha = 0.8, position = position_dodge(width = 0.5)) + 
  scale_color_manual(
    values = c(&quot;Final_pg.mg_A&quot; = &quot;steelblue&quot;,
               &quot;Final_pg.mg_B&quot; = &quot;orange&quot;,
               &quot;Final_pg.mg_D&quot; = &quot;darkgreen&quot;),
    labels = c(&quot;Method A (Basic)&quot;,
               &quot;Method B (Subtraction + x2)&quot;,
               &quot;Method D (Spike contribution)&quot;)
  ) +
  labs(
    title = &quot;Hair Cortisol by Sample and Calculation Method&quot;,
    x = &quot;Sample ID&quot;,
    y = &quot;Final Cortisol (pg/mg)&quot;,
    color = &quot;Method&quot;
  ) +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 90, hjust = 1),
    legend.position = &quot;top&quot;
  )</code></pre>
<p><img src="figure/ELISA_Analysis_FinalVals_comparisons_test3_test4.Rmd/unnamed-chunk-7-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-unnamed-chunk-7-1">
Past versions of unnamed-chunk-7-1.png
</button>
</p>
<div id="fig-unnamed-chunk-7-1" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/PalomaContreras25/HairCort-Evaluation-Nist2020/blob/16ce91c12594e99d1691896d5d0df7dc690fe51d/docs/figure/ELISA_Analysis_FinalVals_comparisons_test3_test4.Rmd/unnamed-chunk-7-1.png" target="_blank">16ce91c</a>
</td>
<td>
Paloma
</td>
<td>
2025-04-10
</td>
</tr>
</tbody>
</table>
</div>
</div>
<pre class="r"><code># Reshape to long format
data_long &lt;- data %&gt;%
  pivot_longer(
    cols = c(Final_pg.mg_A, Final_pg.mg_D),
    names_to = &quot;Method&quot;,
    values_to = &quot;Final_pg.mg&quot;
  )

# Plot

# Plot with lines connecting A and D values for each sample
ggplot(data_long, aes(x = Sample, y = Final_pg.mg, color = Method)) +
  geom_line(aes(group = Sample), color = &quot;gray75&quot;, size = 0.5) +  # light line connecting methods
  geom_point(size = 3, alpha = 0.8, position = position_dodge(width = 0.5)) +
  scale_color_manual(
    values = c(&quot;Final_pg.mg_A&quot; = &quot;steelblue&quot;, 
               &quot;Final_pg.mg_D&quot; = &quot;darkgreen&quot;),
    labels = c(&quot;Method A&quot;, &quot;Method D&quot;)
  ) +
  labs(
    title = &quot;Hair Cortisol Concentration by Sample&quot;,
    x = &quot;Sample ID&quot;,
    y = &quot;Final Cortisol (pg/mg)&quot;,
    color = &quot;Calculation Method&quot;
  ) +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1),
    legend.position = &quot;top&quot;
  )</code></pre>
<p><img src="figure/ELISA_Analysis_FinalVals_comparisons_test3_test4.Rmd/unnamed-chunk-8-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-unnamed-chunk-8-1">
Past versions of unnamed-chunk-8-1.png
</button>
</p>
<div id="fig-unnamed-chunk-8-1" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/PalomaContreras25/HairCort-Evaluation-Nist2020/blob/16ce91c12594e99d1691896d5d0df7dc690fe51d/docs/figure/ELISA_Analysis_FinalVals_comparisons_test3_test4.Rmd/unnamed-chunk-8-1.png" target="_blank">16ce91c</a>
</td>
<td>
Paloma
</td>
<td>
2025-04-10
</td>
</tr>
</tbody>
</table>
</div>
</div>
<pre class="r"><code># Filter to include only good quality samples
data_ok &lt;- data %&gt;%
  filter(Failed_samples == &quot;OK&quot;)

# Reshape data for plotting
data_long_ok &lt;- data_ok %&gt;%
  pivot_longer(
    cols = c(Final_pg.mg_A, Final_pg.mg_D),
    names_to = &quot;Method&quot;,
    values_to = &quot;Final_pg.mg&quot;
  )

print(data_long_ok, n=5)</code></pre>
<pre><code># A tibble: 60 √ó 26
  Sample Wells Raw.OD Binding.Perc Conc_pg.ml Ave_Conc_pg.ml CV.Perc    SD   SEM
  &lt;chr&gt;  &lt;chr&gt;  &lt;dbl&gt;        &lt;dbl&gt;      &lt;dbl&gt;          &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 11     E5     0.939         71.6       497.           513.    4.5   23.1  16.3
2 11     E5     0.939         71.6       497.           513.    4.5   23.1  16.3
3 12     F5     0.422         30        2690           2728     1.92  52.5  37.1
4 12     F5     0.422         30        2690           2728     1.92  52.5  37.1
5 13     G5     0.451         32.1      2412           2477     3.68  91.1  64.4
# ‚Ñπ 55 more rows
# ‚Ñπ 17 more variables: Category &lt;chr&gt;, Weight_mg &lt;dbl&gt;, Buffer_nl &lt;int&gt;,
#   Spike &lt;int&gt;, TotalVol_well_uL &lt;int&gt;, SpikeVol_uL &lt;int&gt;, Dilution &lt;int&gt;,
#   CV_categ &lt;chr&gt;, Binding.Perc_categ &lt;chr&gt;, Failed_samples &lt;chr&gt;,
#   Buffer_ml &lt;dbl&gt;, TotalVol_well_mL &lt;dbl&gt;, SpikeVol_ml &lt;dbl&gt;,
#   Final_pg.mg_B &lt;dbl&gt;, Spike_Contribution &lt;dbl&gt;, Method &lt;chr&gt;,
#   Final_pg.mg &lt;dbl&gt;</code></pre>
<pre class="r"><code># Plot for OK samples only
ggplot(data_long_ok, aes(x = Sample, y = Final_pg.mg, color = Method)) +
  geom_line(aes(group = Sample), color = &quot;gray75&quot;, size = 0.5) +
  geom_point(size = 3, alpha = 0.8, position = position_dodge(width = 0.5)) +
  scale_color_manual(
    values = c(&quot;Final_pg.mg_A&quot; = &quot;steelblue&quot;,
             #  &quot;Final_pg.mg_B&quot; = &quot;orange&quot;,
               &quot;Final_pg.mg_D&quot; = &quot;darkgreen&quot;),
    labels = c(&quot;Method A (Basic)&quot;,
              # &quot;Method B (Subtraction + x2)&quot;,
               &quot;Method D (Spike contribution)&quot;)
  ) +
  labs(
    title = &quot;Hair Cortisol (Good Samples Only) ‚Äî Test3&quot;,
    x = &quot;Sample ID&quot;,
    y = &quot;Final Cortisol (pg/mg)&quot;,
    color = &quot;Method&quot;
  ) +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 90, hjust = 1),
    legend.position = &quot;top&quot;
  )</code></pre>
<p><img src="figure/ELISA_Analysis_FinalVals_comparisons_test3_test4.Rmd/unnamed-chunk-9-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-unnamed-chunk-9-1">
Past versions of unnamed-chunk-9-1.png
</button>
</p>
<div id="fig-unnamed-chunk-9-1" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/PalomaContreras25/HairCort-Evaluation-Nist2020/blob/16ce91c12594e99d1691896d5d0df7dc690fe51d/docs/figure/ELISA_Analysis_FinalVals_comparisons_test3_test4.Rmd/unnamed-chunk-9-1.png" target="_blank">16ce91c</a>
</td>
<td>
Paloma
</td>
<td>
2025-04-10
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div id="eval-test4" class="section level1">
<h1>eval test4</h1>
<pre class="r"><code># Load the dataset
df &lt;- data4

# Clean data 
df &lt;- df %&gt;% filter(!is.na(Final_pg.mg_D), !Sample %in% c(&quot;NSB&quot;, &quot;Blank&quot;, &quot;B0&quot;))

# Set factors for plotting and grouping
df$Dilution_samplef &lt;- as.factor(df$Dilution_sample)
df$Category &lt;- as.factor(df$Category)

# 1. === PARALLELISM TEST ===
# Plot concentration vs. dilution to check for proportional decrease

ggplot(df, aes(x = log10(as.numeric(Dilution_sample)), y = Final_pg.mg_D , color = Category)) +
  geom_point() +
  geom_smooth(method = &quot;lm&quot;, se = FALSE) +
  labs(title = &quot;Parallelism Test&quot;, x = &quot;Log10(Dilution_sample)&quot;, y = &quot;Final Cortisol (pg/mg)&quot;)</code></pre>
<pre><code>`geom_smooth()` using formula = &#39;y ~ x&#39;</code></pre>
<p><img src="figure/ELISA_Analysis_FinalVals_comparisons_test3_test4.Rmd/unnamed-chunk-10-1.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="r"><code># Optional: Run ANOVA for parallelism by slope comparison
parallel_model &lt;- lm(Final_pg.mg_D  ~ log10(Dilution_sample) * Category, data = df)
summary(parallel_model)</code></pre>
<pre><code>
Call:
lm(formula = Final_pg.mg_D ~ log10(Dilution_sample) * Category, 
    data = df)

Residuals:
     Min       1Q   Median       3Q      Max 
-12.9931  -5.8067   0.6305   3.9182  26.1773 

Coefficients: (1 not defined because of singularities)
                                 Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)                       35.0807     6.7795   5.175 1.72e-05 ***
log10(Dilution_sample)             1.5747     6.2462   0.252   0.8028    
CategoryB                        -14.6035     9.5877  -1.523   0.1389    
CategoryC                        -19.8911     9.5877  -2.075   0.0473 *  
CategoryD                        -18.6998     9.5877  -1.950   0.0612 .  
CategoryP                        -15.3363     7.5473  -2.032   0.0517 .  
log10(Dilution_sample):CategoryB  17.3325     8.8335   1.962   0.0598 .  
log10(Dilution_sample):CategoryC   9.4420     8.8335   1.069   0.2942    
log10(Dilution_sample):CategoryD   0.4225     8.8335   0.048   0.9622    
log10(Dilution_sample):CategoryP       NA         NA      NA       NA    
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1

Residual standard error: 9.95 on 28 degrees of freedom
Multiple R-squared:  0.5707,    Adjusted R-squared:  0.4481 
F-statistic: 4.653 on 8 and 28 DF,  p-value: 0.001063</code></pre>
<p>Term Estimate p-value Interpretation (Intercept) 35.08 1.7e-05
Baseline value for TA at no dilution CategoryC ‚Äì19.89 0.0473 * TC starts
significantly lower than TA CategoryD ‚Äì18.70 0.0612 . TD also starts
lower, marginally significant CategoryP ‚Äì15.34 0.0517 . TP slightly
lower, borderline significant Interaction (log10 √ó CategoryB) +17.33
0.0598 . TB‚Äôs slope is steeper than TA (marginal)</p>
<p>TC and TD show parallel dilution curves relative to TA ‚Üí you can
safely apply Method D.</p>
<p>TB may have a steeper slope, suggesting spiking only the first tube
might amplify dilution effect slightly.</p>
<pre class="r"><code>ggplot(df, aes(x = log10(as.numeric(Dilution_sample)), y = Binding.Perc , color = Category)) +
  geom_point() +
  geom_smooth(method = &quot;lm&quot;, se = FALSE) +
  labs(title = &quot;Parallelism Test&quot;, x = &quot;Log10(Dilution_sample)&quot;, y = &quot;Binding %&quot;)</code></pre>
<pre><code>`geom_smooth()` using formula = &#39;y ~ x&#39;</code></pre>
<p><img src="figure/ELISA_Analysis_FinalVals_comparisons_test3_test4.Rmd/plot%20parallelism_binding-1.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="r"><code># Optional: Run ANOVA for parallelism by slope comparison
parallel_model &lt;- lm(Binding.Perc  ~ log10(Dilution_sample) * Category, data = df)
summary(parallel_model)</code></pre>
<pre><code>
Call:
lm(formula = Binding.Perc ~ log10(Dilution_sample) * Category, 
    data = df)

Residuals:
    Min      1Q  Median      3Q     Max 
-11.075  -4.111  -0.100   2.679  13.989 

Coefficients: (1 not defined because of singularities)
                                 Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)                       11.7000     4.1065   2.849  0.00813 ** 
log10(Dilution_sample)            49.8764     3.7835  13.183 1.57e-13 ***
CategoryB                          4.7107     5.8075   0.811  0.42413    
CategoryC                         10.0964     5.8075   1.739  0.09311 .  
CategoryD                          6.1929     5.8075   1.066  0.29537    
CategoryP                          7.9444     4.5716   1.738  0.09324 .  
log10(Dilution_sample):CategoryB  -4.6626     5.3507  -0.871  0.39095    
log10(Dilution_sample):CategoryC  -3.1914     5.3507  -0.596  0.55567    
log10(Dilution_sample):CategoryD  -0.3559     5.3507  -0.067  0.94744    
log10(Dilution_sample):CategoryP       NA         NA      NA       NA    
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1

Residual standard error: 6.027 on 28 degrees of freedom
Multiple R-squared:  0.9715,    Adjusted R-squared:  0.9634 
F-statistic: 119.4 on 8 and 28 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>Term Estimate p-value Interpretation (Intercept) 11.70 0.0081 **
Baseline binding % for Category A (TA) at no dilution
log10(Dilution_sample) 49.88 1.6e-13 *** Strong increase in binding %
with increasing dilution CategoryB 4.71 0.424 TB baseline slightly
higher than TA, not significant CategoryC 10.10 0.093 . TC baseline
marginally higher than TA CategoryD 6.19 0.295 TD not significantly
different from TA at baseline CategoryP 7.94 0.093 . TP marginally
higher binding at baseline log10(Dilution_sample):CategoryB ‚Äì4.66 0.391
TB slope not significantly different from TA
log10(Dilution_sample):CategoryC ‚Äì3.19 0.556 TC slope ‚âà TA
log10(Dilution_sample):CategoryD ‚Äì0.36 0.947 TD slope ‚âà TA</p>
<p>Strong Main Effect of Dilution Binding % increases significantly with
higher dilution (p &lt; 0.001).</p>
<p>This is expected: lower concentration = higher % binding in
competitive ELISA.</p>
<ol start="2" style="list-style-type: decimal">
<li>No Significant Interaction Terms The interaction terms (slope
differences) are not significant (all p &gt; 0.39).</li>
</ol>
<p>This means the binding curves across all categories are parallel.</p>
<ol start="3" style="list-style-type: decimal">
<li>Intercept Differences (Baseline Shift) Some categories (notably TC
and TP) start with higher binding %, but this is only marginally
significant (p ‚âà 0.09).</li>
</ol>
<p>This suggests potential small matrix effects, but not enough to
invalidate comparison.</p>
<pre class="r"><code># 3. === ACCURACY TEST ===
# If you have expected values, compare to observed

# Example expected values for some spiked standards (you can edit this!)
expected_vals &lt;- tibble(
  Sample = c(&quot;STD1&quot;, &quot;STD2&quot;, &quot;STD3&quot;),
  Expected_pg.mg = c(30, 15, 7.5)  # replace with your known expected values
)

# Join expected to observed and compute error
accuracy_df &lt;- df %&gt;%
  inner_join(expected_vals, by = &quot;Sample&quot;) %&gt;%
  mutate(
    AbsError = abs(Final_pg.mg_D  - Expected_pg.mg),
    RelError = AbsError / Expected_pg.mg * 100
  )

# Plot observed vs expected
ggplot(accuracy_df, aes(x = Expected_pg.mg, y = Final_pg.mg_D )) +
  geom_point() +
  geom_abline(slope = 1, intercept = 0, linetype = 2) +
  labs(title = &quot;Accuracy: Observed vs Expected&quot;, x = &quot;Expected (pg/mg)&quot;, y = &quot;Observed (pg/mg)&quot;)</code></pre>
<p><img src="figure/ELISA_Analysis_FinalVals_comparisons_test3_test4.Rmd/unnamed-chunk-11-1.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="r"><code># Log buffer as dilution proxy
df$log_dilution &lt;- log10(df$Dilution_sample)

# Parallelism test for TA vs TC
df_sub &lt;- df %&gt;% filter(Category %in% c(&quot;A&quot;, &quot;C&quot;))

model_parallel &lt;- lm(Final_pg.mg_D ~ log_dilution * Category, data = df_sub)
summary(model_parallel)</code></pre>
<pre><code>
Call:
lm(formula = Final_pg.mg_D ~ log_dilution * Category, data = df_sub)

Residuals:
    Min      1Q  Median      3Q     Max 
-11.329  -5.707   1.022   3.913  15.875 

Coefficients:
                       Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)              35.081      6.369   5.508 0.000259 ***
log_dilution              1.575      5.868   0.268 0.793892    
CategoryC               -19.891      9.007  -2.208 0.051710 .  
log_dilution:CategoryC    9.442      8.299   1.138 0.281752    
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1

Residual standard error: 9.347 on 10 degrees of freedom
Multiple R-squared:  0.4672,    Adjusted R-squared:  0.3074 
F-statistic: 2.923 on 3 and 10 DF,  p-value: 0.08647</code></pre>
<p>Term Estimate p-value Interpretation (Intercept) 35.08 0.0003
Cortisol for TA at dilution = 1 (log10 = 0) log_dilution 1.58 0.794
Slope of dilution for TA ‚Äî not significant CategoryC ‚Äì19.89 0.052 . TC
starts ~20 pg/mg lower than TA ‚Äî borderline significant Interaction
(log_dilution:CategoryC) 9.44 0.282 TC slope vs TA ‚Äî not significant ‚Üí
‚úÖ parallel slopes</p>
<p>üîç Parallelism holds: no significant difference in slope between TA
and TC (p = 0.282)</p>
<p>‚ö†Ô∏è Intercept difference between TA and TC is borderline significant
(p = 0.052)</p>
<p>TC starts lower than TA, suggesting a shift in baseline cortisol, but
dilution behavior is similar</p>
<pre class="r"><code># Filter dataset to include only TA (A) and TC (C)
df_sub &lt;- df %&gt;%
  filter(Category %in% c(&quot;A&quot;, &quot;C&quot;)) %&gt;%
  mutate(
    Category = factor(Category, levels = c(&quot;A&quot;, &quot;C&quot;)),
    log_dilution = log10(Dilution_sample)
  )

# Plot
ggplot(df_sub, aes(x = log_dilution, y = Final_pg.mg_D, color = Category)) +
    geom_smooth(method = &quot;lm&quot;, se = TRUE, linewidth = 1.2, alpha = 0.3) +
  geom_point(size = 3, alpha = 0.8) +

  labs(
    title = &quot;Parallelism Test: TA vs TC&quot;,
    subtitle = &quot;Final Cortisol (pg/mg) vs Log10(Dilution) with 95% CI&quot;,
    x = &quot;Log10(Dilution Sample)&quot;,
    y = &quot;Final Cortisol (pg/mg)&quot;,
    color = &quot;Category&quot;
  ) +
  scale_color_manual(
    values = c(&quot;A&quot; = &quot;steelblue&quot;, &quot;C&quot; = &quot;darkgreen&quot;),
    labels = c(&quot;TA (Non-Spiked)&quot;, &quot;TC (All Dilutions Spiked)&quot;)
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(face = &quot;bold&quot;),
    axis.text.x = element_text(angle = 45, hjust = 1),
    legend.position = &quot;top&quot;
  )</code></pre>
<pre><code>`geom_smooth()` using formula = &#39;y ~ x&#39;</code></pre>
<p><img src="figure/ELISA_Analysis_FinalVals_comparisons_test3_test4.Rmd/unnamed-chunk-12-1.png" width="672" style="display: block; margin: auto;" />
If slope ‚âà 0 and variance is low ‚Üí good precision.</p>
<p>You can also compute %CV across replicates.</p>
<pre class="r"><code># Load your data

# Extract meaningful category label
df$Category &lt;- str_extract(df$Sample, &quot;^T[ABCD]&quot;)

# Keep only A‚ÄìD dilution categories
df &lt;- df %&gt;% filter(Category %in% c(&quot;TA&quot;, &quot;TB&quot;, &quot;TC&quot;, &quot;TD&quot;))

# Create log dilution
df$log_dilution &lt;- log10(df$Dilution_sample)

# All pairwise category combinations
pairs &lt;- combn(unique(df$Category), 2, simplify = FALSE)

# Loop and test each pair for both variables
for (pair in pairs) {
  sub_df &lt;- df %&gt;% filter(Category %in% pair)
  pair_label &lt;- paste(pair, collapse = &quot;_vs_&quot;)
  
  ### 1. Final Values Model
  model_final &lt;- lm(Final_pg.mg_D ~ log_dilution * Category, data = sub_df)
  p_final &lt;- tidy(model_final) %&gt;% 
    filter(str_detect(term, &quot;log_dilution:Category&quot;)) %&gt;%
    pull(p.value)
  
  ### 2. Binding % Model
  model_binding &lt;- lm(Binding.Perc ~ log_dilution * Category, data = sub_df)
  p_bind &lt;- tidy(model_binding) %&gt;% 
    filter(str_detect(term, &quot;log_dilution:Category&quot;)) %&gt;%
    pull(p.value)
  
  ### Plot for Final Values
p1 &lt;- ggplot(sub_df, aes(x = log_dilution, y = Final_pg.mg_D, color = Category)) +
   geom_smooth(method = &quot;lm&quot;, se = TRUE, alpha = 0.3) +  
  geom_point(size = 2) +
   
    labs(
      title = paste(&quot;Final Values ‚Äì&quot;, pair_label),
      subtitle = paste(&quot;Interaction p =&quot;, round(p_final, 4)),
      x = &quot;log10(Dilution)&quot;, y = &quot;Final Cortisol (pg/mg)&quot;
    ) +
    theme_minimal() +
    theme(plot.title = element_text(face = &quot;bold&quot;))
  print(p1)
  
  ### Plot for Binding %
p2 &lt;- ggplot(sub_df, aes(x = log_dilution, y = Binding.Perc, color = Category)) +
   geom_smooth(method = &quot;lm&quot;, se = TRUE, alpha = 0.3) + 
   geom_point(size = 2) +

    labs(
      title = paste(&quot;Binding % ‚Äì&quot;, pair_label),
      subtitle = paste(&quot;Interaction p =&quot;, round(p_bind, 4)),
      x = &quot;log10(Dilution)&quot;, y = &quot;Binding (%)&quot;
    ) +
    theme_minimal() +
    theme(plot.title = element_text(face = &quot;bold&quot;))
  print(p2)
  
  ### Print results to console
  cat(&quot;\n=== &quot;, pair_label, &quot; ===\n&quot;)
  cat(&quot;Interaction p (Final values):&quot;, round(p_final, 4), &quot;\n&quot;)
  cat(&quot;Interaction p (Binding %):   &quot;, round(p_bind, 4), &quot;\n&quot;)
  }</code></pre>
<pre><code>`geom_smooth()` using formula = &#39;y ~ x&#39;</code></pre>
<p><img src="figure/ELISA_Analysis_FinalVals_comparisons_test3_test4.Rmd/unnamed-chunk-13-1.png" width="672" style="display: block; margin: auto;" /></p>
<pre><code>`geom_smooth()` using formula = &#39;y ~ x&#39;</code></pre>
<p><img src="figure/ELISA_Analysis_FinalVals_comparisons_test3_test4.Rmd/unnamed-chunk-13-2.png" width="672" style="display: block; margin: auto;" /></p>
<pre><code>
===  TA_vs_TB  ===
Interaction p (Final values): 0.1637 
Interaction p (Binding %):    0.3807 </code></pre>
<pre><code>`geom_smooth()` using formula = &#39;y ~ x&#39;</code></pre>
<p><img src="figure/ELISA_Analysis_FinalVals_comparisons_test3_test4.Rmd/unnamed-chunk-13-3.png" width="672" style="display: block; margin: auto;" /></p>
<pre><code>`geom_smooth()` using formula = &#39;y ~ x&#39;</code></pre>
<p><img src="figure/ELISA_Analysis_FinalVals_comparisons_test3_test4.Rmd/unnamed-chunk-13-4.png" width="672" style="display: block; margin: auto;" /></p>
<pre><code>
===  TA_vs_TC  ===
Interaction p (Final values): 0.2818 
Interaction p (Binding %):    0.6042 </code></pre>
<pre><code>`geom_smooth()` using formula = &#39;y ~ x&#39;</code></pre>
<p><img src="figure/ELISA_Analysis_FinalVals_comparisons_test3_test4.Rmd/unnamed-chunk-13-5.png" width="672" style="display: block; margin: auto;" /></p>
<pre><code>`geom_smooth()` using formula = &#39;y ~ x&#39;</code></pre>
<p><img src="figure/ELISA_Analysis_FinalVals_comparisons_test3_test4.Rmd/unnamed-chunk-13-6.png" width="672" style="display: block; margin: auto;" /></p>
<pre><code>
===  TA_vs_TD  ===
Interaction p (Final values): 0.9507 
Interaction p (Binding %):    0.9275 </code></pre>
<pre><code>`geom_smooth()` using formula = &#39;y ~ x&#39;</code></pre>
<p><img src="figure/ELISA_Analysis_FinalVals_comparisons_test3_test4.Rmd/unnamed-chunk-13-7.png" width="672" style="display: block; margin: auto;" /></p>
<pre><code>`geom_smooth()` using formula = &#39;y ~ x&#39;</code></pre>
<p><img src="figure/ELISA_Analysis_FinalVals_comparisons_test3_test4.Rmd/unnamed-chunk-13-8.png" width="672" style="display: block; margin: auto;" /></p>
<pre><code>
===  TB_vs_TC  ===
Interaction p (Final values): 0.534 
Interaction p (Binding %):    0.8454 </code></pre>
<pre><code>`geom_smooth()` using formula = &#39;y ~ x&#39;</code></pre>
<p><img src="figure/ELISA_Analysis_FinalVals_comparisons_test3_test4.Rmd/unnamed-chunk-13-9.png" width="672" style="display: block; margin: auto;" /></p>
<pre><code>`geom_smooth()` using formula = &#39;y ~ x&#39;</code></pre>
<p><img src="figure/ELISA_Analysis_FinalVals_comparisons_test3_test4.Rmd/unnamed-chunk-13-10.png" width="672" style="display: block; margin: auto;" /></p>
<pre><code>
===  TB_vs_TD  ===
Interaction p (Final values): 0.1622 
Interaction p (Binding %):    0.4712 </code></pre>
<pre><code>`geom_smooth()` using formula = &#39;y ~ x&#39;</code></pre>
<p><img src="figure/ELISA_Analysis_FinalVals_comparisons_test3_test4.Rmd/unnamed-chunk-13-11.png" width="672" style="display: block; margin: auto;" /></p>
<pre><code>`geom_smooth()` using formula = &#39;y ~ x&#39;</code></pre>
<p><img src="figure/ELISA_Analysis_FinalVals_comparisons_test3_test4.Rmd/unnamed-chunk-13-12.png" width="672" style="display: block; margin: auto;" /></p>
<pre><code>
===  TC_vs_TD  ===
Interaction p (Final values): 0.2768 
Interaction p (Binding %):    0.6738 </code></pre>
<p>Comparison Final Values p Binding % p Interpretation TA vs TB 0.164
0.381 Not significantly different slopes. Likely parallel.</p>
<p>TA vs TC 0.366 0.604 Parallel; spiking all tubes in TC doesn‚Äôt
distort slope much.</p>
<p>TA vs TD 0.951 0.928 Extremely parallel ‚Äî almost identical slopes. TB
vs TC 0.479 0.845 No significant slope difference. Spike methods act
similarly.</p>
<p>TB vs TD 0.162 0.471 Slight trend in slope difference, but still not
statistically significant.</p>
<p>TC vs TD 0.367 0.674 Parallel. Spiking either all tubes (TC) or just
first tube (TD) gives similar dilution response.</p>
<p>All p-values are &gt; 0.05, meaning there is no strong evidence of
non-parallelism.</p>
<p>This suggests your serial dilutions are behaving consistently, even
with different spiking strategies.</p>
<p>The fact that binding percentage curves are also parallel confirms
this is not an artifact of back-calculation ‚Äî it‚Äôs real behavior at the
assay level.</p>
<pre class="r"><code># === Load and prepare data ===
df &lt;- data4 %&gt;%
  mutate(Category = str_extract(Sample, &quot;^T[ABCD]&quot;)) %&gt;%
  filter(Category %in% c(&quot;TA&quot;, &quot;TB&quot;, &quot;TC&quot;, &quot;TD&quot;)) %&gt;%
  mutate(log_dilution = log10(Dilution_sample))

# === Updated and safe function ===
extract_intercepts_with_pval &lt;- function(model, response_label) {
  model_tidy &lt;- tidy(model, conf.int = TRUE)
  intercept_ta &lt;- model_tidy %&gt;% filter(term == &quot;(Intercept)&quot;) %&gt;% pull(estimate)

  intercepts &lt;- model_tidy %&gt;%
    filter(term == &quot;(Intercept)&quot; | str_detect(term, &quot;Category&quot;)) %&gt;%
    mutate(
      Category = case_when(
        term == &quot;(Intercept)&quot; ~ &quot;TA&quot;,
        str_detect(term, &quot;TB&quot;) ~ &quot;TB&quot;,
        str_detect(term, &quot;TC&quot;) ~ &quot;TC&quot;,
        str_detect(term, &quot;TD&quot;) ~ &quot;TD&quot;
      ),
      Estimate = if_else(Category == &quot;TA&quot;, estimate, intercept_ta + estimate),
      CI_low = if_else(Category == &quot;TA&quot;, conf.low, conf.low + intercept_ta),
      CI_high = if_else(Category == &quot;TA&quot;, conf.high, conf.high + intercept_ta),
      P_Value = if_else(Category == &quot;TA&quot;, NA_real_, p.value),
      Variable = response_label
    ) %&gt;%
    dplyr::select(Variable, Category, Estimate, CI_low, CI_high, P_Value)

  return(intercepts)
}

# === Fit models ===
mod_final &lt;- lm(Final_pg.mg_D ~ log_dilution + Category, data = df)
mod_binding &lt;- lm(Binding.Perc ~ log_dilution + Category, data = df)

# === Extract intercepts ===
intercepts_final &lt;- extract_intercepts_with_pval(mod_final, &quot;Final Cortisol (pg/mg)&quot;)
intercepts_binding &lt;- extract_intercepts_with_pval(mod_binding, &quot;Binding Percentage&quot;)

# === Combine and reshape for table ===
intercepts_all &lt;- bind_rows(intercepts_final, intercepts_binding)


# === View final table ===
print(intercepts_final)</code></pre>
<pre><code># A tibble: 4 √ó 6
  Variable               Category Estimate CI_low CI_high  P_Value
  &lt;chr&gt;                  &lt;chr&gt;       &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;
1 Final Cortisol (pg/mg) TA           28.9  17.8     40.1 NA      
2 Final Cortisol (pg/mg) TB           30.0  17.4     42.6  0.865  
3 Final Cortisol (pg/mg) TC           17.6   4.98    30.2  0.0749 
4 Final Cortisol (pg/mg) TD           10.6  -1.98    23.2  0.00628</code></pre>
<pre class="r"><code>cat(&quot;TB (only first tube spiked) behaves almost identically to TA (non-spiked) ‚Üí good parallelism, no signal distortion.

TC (every tube spiked) lowers the intercept but not significantly.

TD (1:1 spike + dilution) significantly suppresses signal, indicating likely dilution or matrix effects.&quot;)</code></pre>
<pre><code>TB (only first tube spiked) behaves almost identically to TA (non-spiked) ‚Üí good parallelism, no signal distortion.

TC (every tube spiked) lowers the intercept but not significantly.

TD (1:1 spike + dilution) significantly suppresses signal, indicating likely dilution or matrix effects.</code></pre>
<pre class="r"><code>print(intercepts_binding)</code></pre>
<pre><code># A tibble: 4 √ó 6
  Variable           Category Estimate CI_low CI_high P_Value
  &lt;chr&gt;              &lt;chr&gt;       &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
1 Binding Percentage TA           13.6   7.41    19.7 NA     
2 Binding Percentage TB           14.1   7.10    21.0  0.883 
3 Binding Percentage TC           20.8  13.8     27.7  0.0426
4 Binding Percentage TD           19.4  12.5     26.4  0.0940</code></pre>
<pre class="r"><code>cat(&quot;TB again tracks closely with TA, confirming consistent assay response.

TC and TD show increased binding, which is unusual ‚Äî spiking may be blocking binding sites or altering matrix effects.

The higher binding % may explain the lower final cortisol values, especially in TD&quot;)</code></pre>
<pre><code>TB again tracks closely with TA, confirming consistent assay response.

TC and TD show increased binding, which is unusual ‚Äî spiking may be blocking binding sites or altering matrix effects.

The higher binding % may explain the lower final cortisol values, especially in TD</code></pre>
<pre class="r"><code># === Plot: Intercepts with CI ===
ggplot(intercepts_all, aes(x = Category, y = Estimate, color = Variable)) +
  geom_point(position = position_dodge(width = 0.5), size = 4) +
  geom_errorbar(aes(ymin = CI_low, ymax = CI_high), 
                width = 0.2, position = position_dodge(width = 0.5)) +
  labs(
    title = &quot;Intercept Estimates for TA‚ÄìTD&quot;,
    subtitle = &quot;With 95% Confidence Intervals&quot;,
    y = &quot;Intercept Value&quot;,
    x = &quot;Category&quot;
  ) +
  theme_minimal() +
  theme(plot.title = element_text(face = &quot;bold&quot;))</code></pre>
<p><img src="figure/ELISA_Analysis_FinalVals_comparisons_test3_test4.Rmd/unnamed-chunk-14-1.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="r"><code># Load your dataset
df &lt;- data4

# === Step 1: Prepare units and constants ===
spike_conc_pgml &lt;- 3200
extraction_ratio &lt;- 1.3

df &lt;- df %&gt;%
  mutate(
    Buffer_ml = Buffer_nl / 1000,
    SpikeVol_ml = SpikeVol_uL / 1000,
    TotalVol_ml = Vol_in_well.tube_uL / 1000,
    Spike_pg_ml_general = (SpikeVol_ml * spike_conc_pgml) / TotalVol_ml,
    
    # === Step 2: General method (simplified subtraction if spiked) ===
    Final_pg_mg_general = case_when(
      Spike == 1 ~ ((Ave_Conc_pg.ml - Spike_pg_ml_general) / Weight_mg) * extraction_ratio * Buffer_ml,
      TRUE ~ (Ave_Conc_pg.ml / Weight_mg) * extraction_ratio * Buffer_ml
    ),
    
    # === Step 3: Method D (per-sample spike contribution, accounts for dilution) ===
    Spike_cont_pg_mL_methodD = ((SpikeVol_ml * spike_conc_pgml) / TotalVol_ml) / Dilution_sample,
    
    Final_pg_mg_methodD = ((Ave_Conc_pg.ml - Spike_cont_pg_mL_methodD) / Weight_mg) * extraction_ratio * Buffer_ml
  )


# Scatter plot: Method D vs General Correction
ggplot(df, aes(x = Final_pg_mg_general, y = Final_pg_mg_methodD, color = as.factor(Spike))) +
  geom_point(size = 3) +
  geom_abline(slope = 1, intercept = 0, linetype = &quot;dashed&quot;, color = &quot;gray40&quot;) +
  labs(
    title = &quot;Spike Correction: General vs Method D&quot;,
    x = &quot;Final Cortisol (pg/mg) ‚Äì General Correction&quot;,
    y = &quot;Final Cortisol (pg/mg) ‚Äì Method D&quot;,
    color = &quot;Spiked&quot;
  ) +
  coord_equal() +
  theme_minimal()</code></pre>
<p><img src="figure/ELISA_Analysis_FinalVals_comparisons_test3_test4.Rmd/unnamed-chunk-15-1.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="r"><code># Bar plot: Difference between methods
df &lt;- df %&gt;%
  mutate(Diff_pg_mg = Final_pg_mg_methodD - Final_pg_mg_general)

ggplot(df, aes(x = Sample, y = Diff_pg_mg, fill = as.factor(Spike))) +
  geom_bar(stat = &quot;identity&quot;) +
  labs(
    title = &quot;Difference in Final Cortisol Values: Method D ‚Äì General&quot;,
    x = &quot;Sample&quot;,
    y = &quot;Difference (pg/mg)&quot;,
    fill = &quot;Spiked&quot;
  ) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1))</code></pre>
<p><img src="figure/ELISA_Analysis_FinalVals_comparisons_test3_test4.Rmd/unnamed-chunk-15-2.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="r"><code>df %&gt;%
  group_by(Spike) %&gt;%
  summarise(
    mean_general = mean(Final_pg_mg_general, na.rm = TRUE),
    mean_methodD = mean(Final_pg_mg_methodD, na.rm = TRUE),
    mean_diff = mean(Diff_pg_mg, na.rm = TRUE),
    sd_diff = sd(Diff_pg_mg, na.rm = TRUE)
  )</code></pre>
<pre><code># A tibble: 2 √ó 5
  Spike mean_general mean_methodD mean_diff sd_diff
  &lt;int&gt;        &lt;dbl&gt;        &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;
1     0         7.60         6.77      0       0   
2     1         8.51        11.2       2.66    3.94</code></pre>
<pre class="r"><code># Step 1: Create sample pairs (adjust as needed)
# e.g., base = TA, spiked = TB with similar Sample ID patterns

# Simulate pairing by shared SampleID (you may need to adjust this step)
df &lt;- data4 %&gt;%
  mutate(SampleID = str_extract(Sample, &quot;\\d+$&quot;))  # Extract trailing numbers

# Pivot data to wide format for paired comparison
paired_df &lt;- df %&gt;%
  filter(Category %in% c(&quot;A&quot;, &quot;C&quot;)) %&gt;%
  filter(!is.na(Binding.Perc)) %&gt;% 
  dplyr::select(SampleID, Category, Final_pg.mg_D ) %&gt;%
  pivot_wider(names_from = Category, values_from = Final_pg.mg_D) 

df &lt;- df %&gt;%
  filter(Category %in% c(&quot;C&quot;)) %&gt;%
  filter(!is.na(Binding.Perc))
# Define spike amount (pg/mg) added per TB sample
Spike_pg_ml = ((df$SpikeVol_ml * 3200) / df$Vol_in_well.tube_ml) / df$Dilution_spike
    
    Spike_pg.mg = (Spike_pg_ml / df$Weight_mg) * df$Extraction_ratio * df$Buffer_ml
 
# Calculate % recovery
paired_df &lt;- paired_df %&gt;%
  mutate(Recovery_pct = ((C - A) / Spike_pg.mg) * 100)

# View
paired_df</code></pre>
<pre><code># A tibble: 7 √ó 4
  SampleID     A     C Recovery_pct
  &lt;chr&gt;    &lt;dbl&gt; &lt;dbl&gt;        &lt;dbl&gt;
1 1         31.2  16.1        -700.
2 2         39.5  25.7        -639.
3 3         30.6  23.6        -325.
4 4         40.4  19.3        -978.
5 5         38.1  17.1        -Inf 
6 6         48.9  23.1        -Inf 
7 7         26.9  51.0         Inf </code></pre>
<pre class="r"><code>summary(paired_df$Recovery_pct)</code></pre>
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
   -Inf    -Inf  -700.0          -481.8     Inf </code></pre>
<br>
<p>
<button type="button" class="btn btn-default btn-workflowr btn-workflowr-sessioninfo" data-toggle="collapse" data-target="#workflowr-sessioninfo" style="display: block;">
<span class="glyphicon glyphicon-wrench" aria-hidden="true"></span>
Session information
</button>
</p>
<div id="workflowr-sessioninfo" class="collapse">
<pre class="r"><code>sessionInfo()</code></pre>
<pre><code>R version 4.4.3 (2025-02-28)
Platform: aarch64-apple-darwin20
Running under: macOS Sequoia 15.4

Matrix products: default
BLAS:   /Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/lib/libRblas.0.dylib 
LAPACK: /Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/lib/libRlapack.dylib;  LAPACK version 3.12.0

locale:
[1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8

time zone: America/Detroit
tzcode source: internal

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

other attached packages:
 [1] lubridate_1.9.3 forcats_1.0.0   stringr_1.5.1   purrr_1.0.2    
 [5] readr_2.1.5     tidyr_1.3.1     tibble_3.2.1    tidyverse_2.0.0
 [9] dplyr_1.1.4     paletteer_1.6.0 broom_1.0.7     ggplot2_3.5.1  
[13] knitr_1.49     

loaded via a namespace (and not attached):
 [1] sass_0.4.9        utf8_1.2.4        generics_0.1.3    lattice_0.22-6   
 [5] stringi_1.8.4     hms_1.1.3         digest_0.6.37     magrittr_2.0.3   
 [9] timechange_0.3.0  evaluate_1.0.1    grid_4.4.3        fastmap_1.2.0    
[13] Matrix_1.7-2      rprojroot_2.0.4   workflowr_1.7.1   jsonlite_1.8.9   
[17] whisker_0.4.1     backports_1.5.0   rematch2_2.1.2    promises_1.3.0   
[21] mgcv_1.9-1        fansi_1.0.6       scales_1.3.0      jquerylib_0.1.4  
[25] cli_3.6.3         rlang_1.1.4       splines_4.4.3     munsell_0.5.1    
[29] withr_3.0.2       cachem_1.1.0      yaml_2.3.10       tools_4.4.3      
[33] tzdb_0.4.0        colorspace_2.1-1  httpuv_1.6.15     vctrs_0.6.5      
[37] R6_2.5.1          lifecycle_1.0.4   git2r_0.35.0      fs_1.6.5         
[41] pkgconfig_2.0.3   pillar_1.9.0      bslib_0.8.0       later_1.3.2      
[45] gtable_0.3.6      glue_1.8.0        Rcpp_1.0.13-1     xfun_0.49        
[49] tidyselect_1.2.1  rstudioapi_0.17.1 farver_2.1.2      nlme_3.1-167     
[53] htmltools_0.5.8.1 labeling_0.4.3    rmarkdown_2.29    compiler_4.4.3   </code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>


<!-- Adjust MathJax settings so that all math formulae are shown using
TeX fonts only; see
https://docs.mathjax.org/en/latest/web/configuration.html. This will make
the presentation more consistent at the cost of the webpage sometimes
taking slightly longer to load. Note that this only works because the
footer is added to webpages before the MathJax javascript. -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    "HTML-CSS": { availableFonts: ["TeX"] }
  });
</script>




</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
