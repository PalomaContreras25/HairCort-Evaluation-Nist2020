
---
title: "ELISA_computation"
author: "Paloma"
date: "2024-10-16"
output: workflowr::wflow_html
editor_options:
  chunk_output_type: console
---

## Introduction
---

```{r echo = FALSE, warning=FALSE, message=FALSE}
# Install libraries
library(dplyr)
library(knitr)
library(ggplot2)
```

```{r setup, include=TRUE, message=FALSE}
df <- read.csv("./data/Data_QC_flagged.csv")


# remove unnecessary information
data <- df %>% 
  select(!(c(Wells, Raw.OD, Concentration_pg.ml, CV.Perc, SD, SEM)))

```
## Calculation

Formula:  ((A/B) * (C/D) * E * 10,000) = F 

- A = μg/dl from assay output;
- B = weight (in mg) of hair subjected to extraction;
- C = vol. (in ml) of methanol added to the powdered hair;
- D = vol. (in ml) of methanol recovered from the extract and subsequently dried down;
- E = vol. (in ml) of assay buffer used to reconstitute the dried extract;
- F = final value of hair CORT concentration in pg/mg.


```{r}
kable(head(data))

# Transform to μg/dl from assay output
data$Average_Conc_ug.dL <- c(data$Average_Conc_pg.ml/10000)

# Creating variables in indicated units
data$Vol_methanol_ml <- 1.3/1

data$Buffer_ml <- c(data$Buffer_nl/1000)

# Calculate final values
data$final_conc_pg.mg <- c((data$Average_Conc_ug.dL / data$Weight_mg) * data$Vol_methanol_ml * data$Buffer_ml * 10000 )


```

## Results 
```{r}

summary(data$final_conc_pg.mg)
kable(head(data))
hist(data$final_conc_pg.mg, col = "cyan4", main = c("Histogram of cort concentration values, considering weight and dilutions"), xlab = "Cortisol concentrations, pg/mg", ylab = "Count", breaks = 60, xlim = range(0:60))

ggplot(data, aes(x = final_conc_pg.mg, y = Weight_mg)) +
  geom_point(color = "cyan4", size = 3) +  # Points with custom color and size
  geom_smooth(method = "lm", color = "gold3", se = FALSE) +  # Regression line without confidence interval
  theme_minimal() +  # Minimalistic theme
  labs(
    title = "Relationship between Final Concentration and Weight",
    x = "Final Concentration (pg/mg)",  # Custom x-axis label
    y = "Weight (mg)"  # Custom y-axis label
  ) +
  theme(
    plot.title = element_text(hjust = 0.5, size = 16, face = "bold"),  # Center title and adjust size
    axis.title = element_text(size = 14),  # Adjust axis label size
    axis.text = element_text(size = 12)  # Adjust axis text size
  )




outliers_29.5 <- data[(data$final_conc_pg.mg >= 29.5), ]
kable(outliers_29.5)

```

## Correct values for spike
```{r}



```




 wflow_publish("./analysis/ELISA_Computation.Rmd")

